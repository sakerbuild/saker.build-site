trigger:
- master

resources:
  pipelines:
    - pipeline: saker_build_ide_eclipse_update_site
      project: 'saker.build.ide.eclipse'
      source: 'saker.build.ide.eclipse-update-site'
      trigger:
        branches:
        - releases/*
  repositories:
  - repository: repo_saker_build
    type: github
    name: 'sakerbuild/saker.build'
    endpoint: sakerbuild
    trigger:
      branches:
        include:
        - master
  - repository: repo_saker_compiler_utils
    type: github
    name: 'sakerbuild/saker.compiler.utils'
    endpoint: sakerbuild
    trigger:
      branches:
        include:
        - master
  - repository: repo_saker_jar
    type: github
    name: 'sakerbuild/saker.jar'
    endpoint: sakerbuild
    trigger:
      branches:
        include:
        - master
  - repository: repo_saker_java_compiler
    type: github
    name: 'sakerbuild/saker.java.compiler'
    endpoint: sakerbuild
    trigger:
      branches:
        include:
        - master
  - repository: repo_saker_java_testing
    type: github
    name: 'sakerbuild/saker.java.testing'
    endpoint: sakerbuild
    trigger:
      branches:
        include:
        - master
  - repository: repo_saker_maven_classpath
    type: github
    name: 'sakerbuild/saker.maven.classpath'
    endpoint: sakerbuild
    trigger:
      branches:
        include:
        - master
  - repository: repo_saker_maven_support
    type: github
    name: 'sakerbuild/saker.maven.support'
    endpoint: sakerbuild
    trigger:
      branches:
        include:
        - master
  - repository: repo_saker_msvc
    type: github
    name: 'sakerbuild/saker.msvc'
    endpoint: sakerbuild
    trigger:
      branches:
        include:
        - master
  - repository: repo_saker_nest
    type: github
    name: 'sakerbuild/saker.nest'
    endpoint: sakerbuild
    trigger:
      branches:
        include:
        - master
  - repository: repo_saker_rmi
    type: github
    name: 'sakerbuild/saker.rmi'
    endpoint: sakerbuild
    trigger:
      branches:
        include:
        - master
  - repository: repo_saker_sdk_support
    type: github
    name: 'sakerbuild/saker.sdk.support'
    endpoint: sakerbuild
    trigger:
      branches:
        include:
        - master
  - repository: repo_saker_standard
    type: github
    name: 'sakerbuild/saker.standard'
    endpoint: sakerbuild
    trigger:
      branches:
        include:
        - master
  - repository: repo_saker_util
    type: github
    name: 'sakerbuild/saker.util'
    endpoint: sakerbuild
    trigger:
      branches:
        include:
        - master
  - repository: repo_saker_zip
    type: github
    name: 'sakerbuild/saker.zip'
    endpoint: sakerbuild
    trigger:
      branches:
        include:
        - master
  - repository: repo_nest_repository_support
    type: github
    name: 'sakerbuild/nest.repository.support'
    endpoint: sakerbuild
    trigger:
      branches:
        include:
        - master

pool:
  vmImage: 'ubuntu-latest'

steps:
- checkout: self
- script: |
    set -e
    pip install PyGithub
  displayName: 'Install PyGithub'
- script: |
    set -e
    ls -la
    mkdir build-update-sites
    cd build-update-sites
    python ../saker.build-site/download_update_sites.py $DOWNLOAD_TOKEN
    for f in *.zip; do
      VER=$(echo "$f" | sed -r 's/site-v(.*)\.zip/\1/')
      echo "$VER" >> _update_site_versions.txt
      unzip "$f" -d "../saker.build-site/site/saker.build.ide.eclipse/update-site/v$VER"
    done
    SAKER_ECLIPSE_VERSION=$(sort -V -r < _update_site_versions.txt | head -n 1)
    echo "##vso[task.setvariable variable=SAKER_ECLIPSE_VERSION]$SAKER_ECLIPSE_VERSION"
    
    echo "saker.build.ide.eclipse version: $SAKER_ECLIPSE_VERSION"
    
    rm _update_site_versions.txt
  displayName: 'Download update sites'
  env:
    DOWNLOAD_TOKEN: $(SITE_DOWNLOAD_TOKEN)
- script: |
    set -e
    SAKER_INTELLIJ_VERSION=python ../saker.build-site/list_release_versions.py $DOWNLOAD_TOKEN "sakerbuild/saker.build.ide.intellij" | sort -V -r | head -n 1
    echo "##vso[task.setvariable variable=SAKER_INTELLIJ_VERSION]$SAKER_INTELLIJ_VERSION"
    echo "saker.build.ide.intellij version: $SAKER_INTELLIJ_VERSION"
  displayName: 'Determine latest IDEA plugin version'
  env:
    DOWNLOAD_TOKEN: $(SITE_DOWNLOAD_TOKEN)
- script: |
    set -e
    SAKER_BUILD_VERSION=$(curl -s https://mirror.nest.saker.build/badges/saker.build/latest.txt)
    SAKER_NEST_VERSION=$(curl -s https://mirror.nest.saker.build/badges/saker.nest/latest.txt)
    curl https://api.nest.saker.build/bundle/download/saker.build-v$SAKER_BUILD_VERSION -o saker.build.jar
    echo "##vso[task.setvariable variable=SAKER_BUILD_VERSION]$SAKER_BUILD_VERSION"
    echo "##vso[task.setvariable variable=SAKER_NEST_VERSION]$SAKER_NEST_VERSION"
    
    echo "saker.build version: $SAKER_BUILD_VERSION"
    echo "saker.nest version: $SAKER_NEST_VERSION"
  displayName: 'Download saker.build'
- script: java -jar ../saker.build.jar -bd build install tasks/saker.build
  displayName: 'Build documentation tasks'
  workingDirectory: saker.build-site
- script: java -jar ../saker.build.jar -bd build testexamples
  displayName: 'Test compile examples'
  workingDirectory: saker.build-site
- script: |
    set -e
    curl -s https://gist.githubusercontent.com/Sipkab/1505a8659af20003ae09295e99d3cba3/raw/azure_ubuntu_jdksetup_variables.sh -o /tmp/azure_ubuntu_jdksetup_variables.sh
    bash /tmp/azure_ubuntu_jdksetup_variables.sh 9
  displayName: 'Setup JDK 9 for Javadoc'
- script: java -jar ../saker.build.jar -bd build "-EUsaker.java.jre.install.locations=$(JAVA_HOME_9_X64)" export doclet/saker.build
  displayName: 'Build doclet'
  workingDirectory: saker.build-site
- checkout: repo_saker_build
  path: s/build-javadoc/saker.build
- checkout: repo_saker_compiler_utils
  path: s/build-javadoc/saker.compiler.utils
- checkout: repo_saker_jar
  path: s/build-javadoc/saker.jar
- checkout: repo_saker_java_compiler
  path: s/build-javadoc/saker.java.compiler
- checkout: repo_saker_java_testing
  path: s/build-javadoc/saker.java.testing
- checkout: repo_saker_maven_classpath
  path: s/build-javadoc/saker.maven.classpath
- checkout: repo_saker_maven_support
  path: s/build-javadoc/saker.maven.support
- checkout: repo_saker_msvc
  path: s/build-javadoc/saker.msvc
- checkout: repo_saker_nest
  path: s/build-javadoc/saker.nest
- checkout: repo_saker_rmi
  path: s/build-javadoc/saker.rmi
- checkout: repo_saker_sdk_support
  path: s/build-javadoc/saker.sdk.support
- checkout: repo_saker_standard
  path: s/build-javadoc/saker.standard
- checkout: repo_saker_util
  path: s/build-javadoc/saker.util
- checkout: repo_saker_zip
  path: s/build-javadoc/saker.zip
- checkout: repo_nest_repository_support
  path: s/build-javadoc/nest.repository.support
- script: |
    set -e	
    mkdir javadoc
    cp saker.build-site/build/saker.jar.create/saker.doclet.jar saker.doclet.jar
    cd build-javadoc
    curl https://api.nest.saker.build/bundle/download/saker.apiextract-api-v$(curl -s https://mirror.nest.saker.build/badges/saker.apiextract/latest.txt) -o saker.apiextract-api.jar
    curl https://api.nest.saker.build/bundle/download/saker.build-api-v$(SAKER_BUILD_VERSION) -o saker.build-api.jar
    curl https://api.nest.saker.build/bundle/download/saker.nest-api-v$(SAKER_NEST_VERSION) -o saker.nest-api.jar
  displayName: 'Setup javadoc libs'
- script: $(JAVA_HOME_9_X64)/bin/javadoc -locale en_US -sourcepath "../saker.build-site/doclet/pseudo:saker.build/core/common:saker.build/thirdparty/rmi/api/src:saker.build/thirdparty/rmi/impl/src:saker.build/thirdparty/utils/common:saker.build/thirdparty/utils/jdk8:saker.build/core/test/api/common:saker.build/core/test/api/enabled:saker.build/thirdparty/asm/src:saker.build/core/jdk8" -docletpath "../saker.build.jar:../saker.doclet.jar" -doclet saker.doclet.SakerDoclet -subpackages saker -classpath saker.apiextract-api.jar -apijar saker.build-api.jar -d javadoc/saker.build/javadoc -template ../saker.build-site/templates/javadoc_template.html -index-title "Saker.build API JavaDoc" -embed-macro DOC_FOOTER_TEMPLATE ../saker.build-site/templates/footer/packagefootertemplate.html -embed-macro DOC_NAV_TEMPLATE ../saker.build-site/templates/nav/navtemplate.html -macro "<!-- DOC-PATH-TO-ROOT-DIR -->" "JAVADOC_ROOT../" -macro PACKAGE_NAME saker.build -macro DOC_DATA_PRESENCE "nest-package packagedoc javadoc" -macro FOOTER_COPYRIGHT "Bence Sipka 2020" -error-reporting warning -warning-format "##vso[task.logissue type=warning]%s" -error-format "##vso[task.logissue type=error]%s"
  displayName: 'Javadoc: saker.build'
  workingDirectory: build-javadoc
- script: $(JAVA_HOME_9_X64)/bin/javadoc -locale en_US -sourcepath "../saker.build-site/doclet/pseudo:saker.build/core/common:saker.build/thirdparty/rmi/api/src:saker.build/thirdparty/rmi/impl/src:saker.build/thirdparty/utils/common:saker.build/thirdparty/utils/jdk8:saker.build/core/test/api/common:saker.build/core/test/api/enabled:saker.build/thirdparty/asm/src:saker.build/core/jdk8:saker.nest/src:saker.nest/json:saker.nest/test/disabled:saker.nest/test/api" -docletpath "../saker.build.jar:../saker.doclet.jar" -doclet saker.doclet.SakerDoclet -subpackages saker -classpath saker.apiextract-api.jar:saker.build-api.jar -apijar saker.nest-api.jar -d javadoc/saker.nest/javadoc -template ../saker.build-site/templates/javadoc_template.html -index-title "Saker.nest API JavaDoc" -embed-macro DOC_FOOTER_TEMPLATE ../saker.build-site/templates/footer/packagefootertemplate.html -embed-macro DOC_NAV_TEMPLATE ../saker.build-site/templates/nav/navtemplate.html -macro "<!-- DOC-PATH-TO-ROOT-DIR -->" "JAVADOC_ROOT../" -macro PACKAGE_NAME saker.nest -macro DOC_DATA_PRESENCE "nest-package packagedoc javadoc" -external-doc saker.build.** /saker.build/javadoc/ -external-doc saker.util.** /saker.util/javadoc/ -external-doc saker.rmi.** /saker.rmi/javadoc/ -macro FOOTER_COPYRIGHT "Bence Sipka 2020" -error-reporting warning -warning-format "##vso[task.logissue type=warning]%s" -error-format "##vso[task.logissue type=error]%s"
  displayName: 'Javadoc: saker.nest'
  workingDirectory: build-javadoc
- script: $(JAVA_HOME_9_X64)/bin/javadoc -locale en_US -sourcepath "../saker.build-site/doclet/pseudo:saker.build/core/common:saker.build/thirdparty/rmi/api/src:saker.build/thirdparty/rmi/impl/src:saker.build/thirdparty/utils/common:saker.build/thirdparty/utils/jdk8:saker.build/core/test/api/common:saker.build/core/test/api/enabled:saker.build/thirdparty/asm/src:saker.build/core/jdk8:saker.nest/src:saker.nest/json:saker.nest/test/disabled:saker.nest/test/api:saker.standard/src:saker.sdk.support/src/main:saker.compiler.utils/api/src/main:saker.compiler.utils/impl/src/main:saker.msvc/src/main:saker.msvc/testapi/common:saker.msvc/testapi/disabled" -docletpath "../saker.build.jar:../saker.doclet.jar" -doclet saker.doclet.SakerDoclet -subpackages saker.msvc.api -classpath saker.apiextract-api.jar:saker.nest-api.jar:saker.build-api.jar -d javadoc/saker.msvc/javadoc -template ../saker.build-site/templates/javadoc_template.html -index-title "Saker.msvc API JavaDoc" -embed-macro DOC_FOOTER_TEMPLATE ../saker.build-site/templates/footer/packagefootertemplate.html -embed-macro DOC_NAV_TEMPLATE ../saker.build-site/templates/nav/navtemplate.html -macro "<!-- DOC-PATH-TO-ROOT-DIR -->" "JAVADOC_ROOT../" -macro PACKAGE_NAME saker.msvc -macro DOC_DATA_PRESENCE "nest-package packagedoc taskdoc javadoc" -external-doc saker.build.** /saker.build/javadoc/ -external-doc saker.util.** /saker.util/javadoc/ -external-doc saker.rmi.** /saker.rmi/javadoc/ -external-doc saker.nest.** /saker.nest/javadoc/ -external-doc saker.compiler.utils.** /saker.compiler.utils/javadoc/ -external-doc saker.sdk.support.** /saker.sdk.support/javadoc/ -macro FOOTER_COPYRIGHT "Bence Sipka 2020" -error-reporting warning -warning-format "##vso[task.logissue type=warning]%s" -error-format "##vso[task.logissue type=error]%s"
  displayName: 'Javadoc: saker.msvc'
  workingDirectory: build-javadoc
- script: $(JAVA_HOME_9_X64)/bin/javadoc -locale en_US -sourcepath "../saker.build-site/doclet/pseudo:saker.build/core/common:saker.build/thirdparty/rmi/api/src:saker.build/thirdparty/rmi/impl/src:saker.build/thirdparty/utils/common:saker.build/thirdparty/utils/jdk8:saker.build/core/test/api/common:saker.build/core/test/api/enabled:saker.build/thirdparty/asm/src:saker.build/core/jdk8:saker.nest/src:saker.nest/json:saker.nest/test/disabled:saker.nest/test/api:saker.standard/src:saker.sdk.support/src/main:saker.compiler.utils/api/src/main:saker.compiler.utils/impl/src/main" -docletpath "../saker.build.jar:../saker.doclet.jar" -doclet saker.doclet.SakerDoclet -subpackages saker.compiler.utils.api -classpath saker.apiextract-api.jar:saker.nest-api.jar:saker.build-api.jar -d javadoc/saker.compiler.utils/javadoc -template ../saker.build-site/templates/javadoc_template.html -index-title "Saker.compiler.utils API JavaDoc" -embed-macro DOC_FOOTER_TEMPLATE ../saker.build-site/templates/footer/packagefootertemplate.html -embed-macro DOC_NAV_TEMPLATE ../saker.build-site/templates/nav/navtemplate.html -macro "<!-- DOC-PATH-TO-ROOT-DIR -->" "JAVADOC_ROOT../" -macro PACKAGE_NAME saker.compiler.utils -macro DOC_DATA_PRESENCE "nest-package packagedoc javadoc" -external-doc saker.build.** /saker.build/javadoc/ -external-doc saker.util.** /saker.util/javadoc/ -external-doc saker.rmi.** /saker.rmi/javadoc/ -external-doc saker.nest.** /saker.nest/javadoc/ -external-doc saker.sdk.support.** /saker.sdk.support/javadoc/ -macro FOOTER_COPYRIGHT "Bence Sipka 2020" -error-reporting warning -warning-format "##vso[task.logissue type=warning]%s" -error-format "##vso[task.logissue type=error]%s"
  displayName: 'Javadoc: saker.compiler.utils'
  workingDirectory: build-javadoc
- script: $(JAVA_HOME_9_X64)/bin/javadoc -locale en_US -sourcepath "../saker.build-site/doclet/pseudo:saker.build/core/common:saker.build/thirdparty/rmi/api/src:saker.build/thirdparty/rmi/impl/src:saker.build/thirdparty/utils/common:saker.build/thirdparty/utils/jdk8:saker.build/core/test/api/common:saker.build/core/test/api/enabled:saker.build/thirdparty/asm/src:saker.build/core/jdk8:saker.nest/src:saker.nest/json:saker.nest/test/disabled:saker.nest/test/api:saker.standard/src:saker.sdk.support/src/main:saker.compiler.utils/api/src/main:saker.compiler.utils/impl/src/main:saker.zip/api/src/main:saker.zip/main/src/main:saker.zip/impl/src/main" -docletpath "../saker.build.jar:../saker.doclet.jar" -doclet saker.doclet.SakerDoclet -subpackages saker.zip.api -classpath saker.apiextract-api.jar:saker.nest-api.jar:saker.build-api.jar -d javadoc/saker.zip/javadoc -template ../saker.build-site/templates/javadoc_template.html -index-title "Saker.zip API JavaDoc" -embed-macro DOC_FOOTER_TEMPLATE ../saker.build-site/templates/footer/packagefootertemplate.html -embed-macro DOC_NAV_TEMPLATE ../saker.build-site/templates/nav/navtemplate.html -macro "<!-- DOC-PATH-TO-ROOT-DIR -->" "JAVADOC_ROOT../" -macro PACKAGE_NAME saker.zip -macro DOC_DATA_PRESENCE "nest-package packagedoc javadoc taskdoc" -external-doc saker.build.** /saker.build/javadoc/ -external-doc saker.util.** /saker.util/javadoc/ -external-doc saker.rmi.** /saker.rmi/javadoc/ -external-doc saker.nest.** /saker.nest/javadoc/ -external-doc saker.sdk.support.** /saker.sdk.support/javadoc/ -external-doc saker.std.** /saker.standard/javadoc/ -macro FOOTER_COPYRIGHT "Bence Sipka 2020" -error-reporting warning -warning-format "##vso[task.logissue type=warning]%s" -error-format "##vso[task.logissue type=error]%s"
  displayName: 'Javadoc: saker.zip'
  workingDirectory: build-javadoc
- script: $(JAVA_HOME_9_X64)/bin/javadoc -locale en_US -sourcepath "../saker.build-site/doclet/pseudo:saker.build/core/common:saker.build/thirdparty/rmi/api/src:saker.build/thirdparty/rmi/impl/src:saker.build/thirdparty/utils/common:saker.build/thirdparty/utils/jdk8:saker.build/core/test/api/common:saker.build/core/test/api/enabled:saker.build/thirdparty/asm/src:saker.build/core/jdk8:saker.nest/src:saker.nest/json:saker.nest/test/disabled:saker.nest/test/api:saker.standard/src:saker.sdk.support/src/main" -docletpath "../saker.build.jar:../saker.doclet.jar" -doclet saker.doclet.SakerDoclet -subpackages saker.sdk.support.api -classpath saker.apiextract-api.jar:saker.nest-api.jar:saker.build-api.jar -d javadoc/saker.sdk.support/javadoc -template ../saker.build-site/templates/javadoc_template.html -index-title "Saker.sdk.support API JavaDoc" -embed-macro DOC_FOOTER_TEMPLATE ../saker.build-site/templates/footer/packagefootertemplate.html -embed-macro DOC_NAV_TEMPLATE ../saker.build-site/templates/nav/navtemplate.html -macro "<!-- DOC-PATH-TO-ROOT-DIR -->" "JAVADOC_ROOT../" -macro PACKAGE_NAME saker.sdk.support -macro DOC_DATA_PRESENCE "nest-package packagedoc javadoc taskdoc" -external-doc saker.build.** /saker.build/javadoc/ -external-doc saker.util.** /saker.util/javadoc/ -external-doc saker.rmi.** /saker.rmi/javadoc/ -external-doc saker.nest.** /saker.nest/javadoc/ -external-doc saker.std.** /saker.standard/javadoc/ -macro FOOTER_COPYRIGHT "Bence Sipka 2020" -error-reporting warning -warning-format "##vso[task.logissue type=warning]%s" -error-format "##vso[task.logissue type=error]%s"
  displayName: 'Javadoc: saker.sdk.support'
  workingDirectory: build-javadoc
- script: $(JAVA_HOME_9_X64)/bin/javadoc -locale en_US -sourcepath "../saker.build-site/doclet/pseudo:saker.build/core/common:saker.build/thirdparty/rmi/api/src:saker.build/thirdparty/rmi/impl/src:saker.build/thirdparty/utils/common:saker.build/thirdparty/utils/jdk8:saker.build/core/test/api/common:saker.build/core/test/api/enabled:saker.build/thirdparty/asm/src:saker.build/core/jdk8:saker.nest/src:saker.nest/json:saker.nest/test/disabled:saker.nest/test/api:saker.standard/src:saker.sdk.support/src/main:saker.maven.support/api/src/main:saker.maven.support/main/src/main:saker.maven.support/impl/src/main" -docletpath "../saker.build.jar:../saker.doclet.jar" -doclet saker.doclet.SakerDoclet -subpackages saker.maven.support.api -classpath saker.apiextract-api.jar:saker.nest-api.jar:saker.build-api.jar:saker.maven.support/lib/saker.maven.support-lib-v0.8.2.jar -d javadoc/saker.maven.support/javadoc -template ../saker.build-site/templates/javadoc_template.html -index-title "Saker.maven.support API JavaDoc" -embed-macro DOC_FOOTER_TEMPLATE ../saker.build-site/templates/footer/packagefootertemplate.html -embed-macro DOC_NAV_TEMPLATE ../saker.build-site/templates/nav/navtemplate.html -macro "<!-- DOC-PATH-TO-ROOT-DIR -->" "JAVADOC_ROOT../" -macro PACKAGE_NAME saker.maven.support -macro DOC_DATA_PRESENCE "nest-package packagedoc javadoc taskdoc" -external-doc saker.build.** /saker.build/javadoc/ -external-doc saker.util.** /saker.util/javadoc/ -external-doc saker.rmi.** /saker.rmi/javadoc/ -external-doc saker.nest.** /saker.nest/javadoc/ -external-doc saker.std.** /saker.standard/javadoc/ -external-doc saker.sdk.support.** /saker.sdk.support/javadoc/ -macro FOOTER_COPYRIGHT "Bence Sipka 2020" -error-reporting warning -warning-format "##vso[task.logissue type=warning]%s" -error-format "##vso[task.logissue type=error]%s"
  displayName: 'Javadoc: saker.maven.support'
  workingDirectory: build-javadoc
- script: $(JAVA_HOME_9_X64)/bin/javadoc -locale en_US -sourcepath "../saker.build-site/doclet/pseudo:saker.build/core/common:saker.build/thirdparty/rmi/api/src:saker.build/thirdparty/rmi/impl/src:saker.build/thirdparty/utils/common:saker.build/thirdparty/utils/jdk8:saker.build/core/test/api/common:saker.build/core/test/api/enabled:saker.build/thirdparty/asm/src:saker.build/core/jdk8:saker.nest/src:saker.nest/json:saker.nest/test/disabled:saker.nest/test/api:saker.standard/src:saker.sdk.support/src/main:saker.compiler.utils/api/src/main:saker.compiler.utils/impl/src/main:saker.java.compiler/api/src/main:saker.java.compiler/impl/src/main:saker.java.compiler/impl/src/asm:saker.java.compiler/impl-util-jdk8/src/main:saker.java.compiler/impl-jdk8/src/main:saker.java.compiler/testapi/api/common:saker.java.compiler/testapi/api/disabled" -docletpath "../saker.build.jar:../saker.doclet.jar" -doclet saker.doclet.SakerDoclet -subpackages saker.java.compiler.api -classpath saker.apiextract-api.jar:saker.nest-api.jar:saker.build-api.jar -d javadoc/saker.java.compiler/javadoc -template ../saker.build-site/templates/javadoc_template.html -index-title "Saker.java.compiler API JavaDoc" -embed-macro DOC_FOOTER_TEMPLATE ../saker.build-site/templates/footer/packagefootertemplate.html -embed-macro DOC_NAV_TEMPLATE ../saker.build-site/templates/nav/navtemplate.html -macro "<!-- DOC-PATH-TO-ROOT-DIR -->" "JAVADOC_ROOT../" -macro PACKAGE_NAME saker.java.compiler -macro DOC_DATA_PRESENCE "nest-package packagedoc javadoc taskdoc" -external-doc saker.build.** /saker.build/javadoc/ -external-doc saker.util.** /saker.util/javadoc/ -external-doc saker.rmi.** /saker.rmi/javadoc/ -external-doc saker.nest.** /saker.nest/javadoc/ -external-doc saker.std.** /saker.standard/javadoc/ -external-doc saker.sdk.support.** /saker.sdk.support/javadoc/ -external-doc saker.compiler.utils.** /saker.compiler.utils/javadoc/ --add-exports jdk.compiler/com.sun.tools.javac.code=ALL-UNNAMED --add-exports jdk.compiler/com.sun.tools.javac.tree=ALL-UNNAMED  --add-exports jdk.compiler/com.sun.tools.javac.api=ALL-UNNAMED --add-exports jdk.compiler/com.sun.tools.javac.comp=ALL-UNNAMED --add-exports jdk.compiler/com.sun.tools.javac.jvm=ALL-UNNAMED --add-exports jdk.compiler/com.sun.tools.javac.util=ALL-UNNAMED --add-exports jdk.compiler/com.sun.tools.javac.model=ALL-UNNAMED --add-exports jdk.compiler/com.sun.tools.javac.main=ALL-UNNAMED -macro FOOTER_COPYRIGHT "Bence Sipka 2020" -error-reporting warning -warning-format "##vso[task.logissue type=warning]%s" -error-format "##vso[task.logissue type=error]%s"
  displayName: 'Javadoc: saker.java.compiler'
  workingDirectory: build-javadoc
- script: $(JAVA_HOME_9_X64)/bin/javadoc -locale en_US -sourcepath "../saker.build-site/doclet/pseudo:saker.build/core/common:saker.build/thirdparty/rmi/api/src:saker.build/thirdparty/rmi/impl/src:saker.build/thirdparty/utils/common:saker.build/thirdparty/utils/jdk8:saker.build/core/test/api/common:saker.build/core/test/api/enabled:saker.build/thirdparty/asm/src:saker.build/core/jdk8:saker.nest/src:saker.nest/json:saker.nest/test/disabled:saker.nest/test/api:nest.repository.support/api/src/main:nest.repository.support/main/src/main:nest.repository.support/impl/src/main" -docletpath "../saker.build.jar:../saker.doclet.jar" -doclet saker.doclet.SakerDoclet -subpackages saker.nest.support.api -classpath saker.apiextract-api.jar:saker.nest-api.jar:saker.build-api.jar -d javadoc/nest.repository.support/javadoc -template ../saker.build-site/templates/javadoc_template.html -index-title "Nest.repository.support API JavaDoc" -embed-macro DOC_FOOTER_TEMPLATE ../saker.build-site/templates/footer/packagefootertemplate.html -embed-macro DOC_NAV_TEMPLATE ../saker.build-site/templates/nav/navtemplate.html -macro "<!-- DOC-PATH-TO-ROOT-DIR -->" "JAVADOC_ROOT../" -macro PACKAGE_NAME nest.repository.support -macro DOC_DATA_PRESENCE "nest-package packagedoc javadoc taskdoc" -external-doc saker.build.** /saker.build/javadoc/ -external-doc saker.util.** /saker.util/javadoc/ -external-doc saker.rmi.** /saker.rmi/javadoc/ -external-doc saker.nest.support.** NULL -external-doc saker.nest.** /saker.nest/javadoc/ -external-doc saker.std.** /saker.standard/javadoc/ -external-doc saker.sdk.support.** /saker.sdk.support/javadoc/ -macro FOOTER_COPYRIGHT "Bence Sipka 2020" -error-reporting warning -warning-format "##vso[task.logissue type=warning]%s" -error-format "##vso[task.logissue type=error]%s"
  displayName: 'Javadoc: nest.repository.support'
  workingDirectory: build-javadoc
- script: $(JAVA_HOME_9_X64)/bin/javadoc -locale en_US -sourcepath "../saker.build-site/doclet/pseudo:saker.build/core/common:saker.build/thirdparty/rmi/api/src:saker.build/thirdparty/rmi/impl/src:saker.build/thirdparty/utils/common:saker.build/thirdparty/utils/jdk8:saker.build/core/test/api/common:saker.build/core/test/api/enabled:saker.build/thirdparty/asm/src:saker.build/core/jdk8:saker.nest/src:saker.nest/json:saker.nest/test/disabled:saker.nest/test/api:saker.standard/src:saker.sdk.support/src/main:saker.compiler.utils/api/src/mainsaker.compiler.utils/impl/src/main:saker.java.compiler/api/src/main:saker.java.compiler/impl/src/main:saker.java.compiler/impl-util-jdk8/src/main:saker.java.compiler/impl-jdk8/src/main:saker.java.testing/main/src/main:saker.java.testing/api/src/main:saker.java.testing/impl/src/main:saker.java.testing/src-bootstrapagent-common" -docletpath "../saker.build.jar:../saker.doclet.jar" -doclet saker.doclet.SakerDoclet -subpackages saker.java.testing.api -classpath saker.apiextract-api.jar:saker.nest-api.jar:saker.build-api.jar -d javadoc/saker.java.testing/javadoc -template ../saker.build-site/templates/javadoc_template.html -index-title "Saker.java.testing API JavaDoc" -embed-macro DOC_FOOTER_TEMPLATE ../saker.build-site/templates/footer/packagefootertemplate.html -embed-macro DOC_NAV_TEMPLATE ../saker.build-site/templates/nav/navtemplate.html -macro "<!-- DOC-PATH-TO-ROOT-DIR -->" "JAVADOC_ROOT../" -macro PACKAGE_NAME saker.java.testing -macro DOC_DATA_PRESENCE "nest-package packagedoc javadoc taskdoc" -external-doc saker.build.** /saker.build/javadoc/ -external-doc saker.util.** /saker.util/javadoc/ -external-doc saker.rmi.** /saker.rmi/javadoc/ -external-doc saker.nest.** /saker.nest/javadoc/ -external-doc saker.std.** /saker.standard/javadoc/ -external-doc saker.sdk.support.** /saker.sdk.support/javadoc/ -external-doc saker.compiler.utils.** /saker.compiler.utils/javadoc/ -external-doc saker.java.compiler.** /saker.java.compiler/javadoc/ -macro FOOTER_COPYRIGHT "Bence Sipka 2020" -error-reporting warning -warning-format "##vso[task.logissue type=warning]%s" -error-format "##vso[task.logissue type=error]%s"
  displayName: 'Javadoc: saker.java.testing'
  workingDirectory: build-javadoc
- script: $(JAVA_HOME_9_X64)/bin/javadoc -locale en_US -sourcepath "../saker.build-site/doclet/pseudo:saker.build/core/common:saker.build/thirdparty/rmi/api/src:saker.build/thirdparty/rmi/impl/src:saker.build/thirdparty/utils/common:saker.build/thirdparty/utils/jdk8:saker.build/core/test/api/common:saker.build/core/test/api/enabled:saker.build/thirdparty/asm/src:saker.build/core/jdk8:saker.nest/src:saker.nest/json:saker.nest/test/disabled:saker.nest/test/api:saker.standard/src:saker.sdk.support/src/main" -docletpath "../saker.build.jar:../saker.doclet.jar" -doclet saker.doclet.SakerDoclet -subpackages saker.std.api -classpath saker.apiextract-api.jar:saker.nest-api.jar:saker.build-api.jar -d javadoc/saker.standard/javadoc -template ../saker.build-site/templates/javadoc_template.html -index-title "Saker.standard API JavaDoc" -embed-macro DOC_FOOTER_TEMPLATE ../saker.build-site/templates/footer/packagefootertemplate.html -embed-macro DOC_NAV_TEMPLATE ../saker.build-site/templates/nav/navtemplate.html -macro "<!-- DOC-PATH-TO-ROOT-DIR -->" "JAVADOC_ROOT../" -macro PACKAGE_NAME saker.standard -macro DOC_DATA_PRESENCE "nest-package packagedoc javadoc taskdoc" -external-doc saker.build.** /saker.build/javadoc/ -external-doc saker.util.** /saker.util/javadoc/ -external-doc saker.rmi.** /saker.rmi/javadoc/ -external-doc saker.nest.** /saker.nest/javadoc/ -external-doc saker.sdk.support.** /saker.sdk.support/javadoc/ -external-doc saker.compiler.utils.** /saker.compiler.utils/javadoc/ -external-doc saker.java.compiler.** /saker.java.compiler/javadoc/ -macro FOOTER_COPYRIGHT "Bence Sipka 2020" -error-reporting warning -warning-format "##vso[task.logissue type=warning]%s" -error-format "##vso[task.logissue type=error]%s"
  displayName: 'Javadoc: saker.standard'
  workingDirectory: build-javadoc
- script: $(JAVA_HOME_9_X64)/bin/javadoc -locale en_US -sourcepath "../saker.build-site/doclet/pseudo:saker.util/src/common:saker.util/src/jdk8:saker.rmi/api/src:saker.rmi/main/src:saker.rmi/asm/v7.2" -docletpath "../saker.build.jar:../saker.doclet.jar" -doclet saker.doclet.SakerDoclet -subpackages saker.rmi -classpath saker.apiextract-api.jar -d javadoc/saker.rmi/javadoc -template ../saker.build-site/templates/javadoc_template.html -index-title "Saker.rmi API JavaDoc" -embed-macro DOC_FOOTER_TEMPLATE ../saker.build-site/templates/footer/packagefootertemplate.html -embed-macro DOC_NAV_TEMPLATE ../saker.build-site/templates/nav/navtemplate.html -macro "<!-- DOC-PATH-TO-ROOT-DIR -->" "JAVADOC_ROOT../" -macro PACKAGE_NAME saker.rmi -macro DOC_DATA_PRESENCE "nest-package packagedoc javadoc taskdoc"  -external-doc saker.util.** /saker.util/javadoc/ -exclude-class saker.rmi.connection.RemoteProxyObject.** -macro FOOTER_COPYRIGHT "Bence Sipka 2020" -error-reporting warning -warning-format "##vso[task.logissue type=warning]%s" -error-format "##vso[task.logissue type=error]%s"
  displayName: 'Javadoc: saker.rmi'
  workingDirectory: build-javadoc
- script: $(JAVA_HOME_9_X64)/bin/javadoc -locale en_US -sourcepath "../saker.build-site/doclet/pseudo:saker.util/src/common:saker.util/src/jdk8:saker.rmi/api/src" -docletpath "../saker.build.jar:../saker.doclet.jar" -doclet saker.doclet.SakerDoclet -subpackages saker.util -classpath saker.apiextract-api.jar -d javadoc/saker.util/javadoc -template ../saker.build-site/templates/javadoc_template.html -index-title "Saker.util API JavaDoc" -embed-macro DOC_FOOTER_TEMPLATE ../saker.build-site/templates/footer/packagefootertemplate.html -embed-macro DOC_NAV_TEMPLATE ../saker.build-site/templates/nav/navtemplate.html -macro "<!-- DOC-PATH-TO-ROOT-DIR -->" "JAVADOC_ROOT../" -macro PACKAGE_NAME saker.util -macro DOC_DATA_PRESENCE "nest-package packagedoc javadoc taskdoc"  -external-doc saker.rmi.** /saker.rmi/javadoc/ -macro FOOTER_COPYRIGHT "Bence Sipka 2020" -error-reporting warning -warning-format "##vso[task.logissue type=warning]%s" -error-format "##vso[task.logissue type=error]%s"
  displayName: 'Javadoc: saker.util'
  workingDirectory: build-javadoc
- script: cp -r build-javadoc/javadoc/* saker.build-site/site/
  displayName: 'Copy Javadoc results to working tree'
- script: java -jar ../saker.build.jar -bd build "-Usaker.java.jre.install.locations=$(JAVA_HOME_9_X64)" "-Usite.version.saker.build=$(SAKER_BUILD_VERSION)" "-Usite.version.saker.nest=$(SAKER_NEST_VERSION)" "-Usite.version.saker.build.ide.eclipse=$(SAKER_ECLIPSE_VERSION)" "-Usite.version.saker.build.ide.intellij=$(SAKER_INTELLIJ_VERSION)" build
  displayName: 'Generate site'
  workingDirectory: saker.build-site

- script: |
    set -e
    mkdir build-staging
    cd build-staging
    git clone --single-branch --branch gh-pages https://$GIT_USERNAME:$GIT_TOKEN@github.com/$GITHUB_PUBLISH_REPOSITORY .
    git config user.email "support@saker.build"
    git config user.name "sakerbuild-bot"
    git rm -r *
    git checkout HEAD -- CNAME
    cp -r ../saker.build-site/build/saker.site.doc.gen/site/* ./
    find . -not -path '*/\.*' | grep '\.html$' | sed -e 's/^./https:\/\/saker.build/' | sort > sitemap.txt
    git add --all
    if [[ -n $(git status -s) ]]
    then
      git commit -a -m "Automated site update" -m "Via commit sakerbuild/saker.build-site@$COMMIT_ID"
      git push
    fi
  env:
    GIT_USERNAME: $(PAGE_PUSH_USERNAME)
    GIT_TOKEN: $(PAGE_PUSH_TOKEN)
    COMMIT_ID: $(Build.SourceVersion)
  displayName: 'Push site'
  condition: and(and(succeeded(), ne(variables['GITHUB_PUBLISH_REPOSITORY'], '')), ne(variables['Build.Reason'], 'PullRequest'))
