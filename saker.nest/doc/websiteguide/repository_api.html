<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Repository web API&nbsp;|&nbsp;saker.nest</title>
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"/>
	
	<link rel="stylesheet" href="../../../res/bootstrap.min.css" >
	<link rel="stylesheet" href="../../../res/doc-saker.css" >
</head>
<body data-nav-location="packagedoc" data-subdoc-presence="nest-package packagedoc javadoc">
<div class="doc-nav-bar">
	<div class="container">
		<a class="home-link" href="../../index.html" title="saker.nest"><img style="height: 2.5em;" class="logo" src="../../../res/logo.svg"/><span class="page-name">saker.nest</span></a>
		<a class="nav-location-item" data-nav-location="doc-docs" href="../../doc/index.html" title="Documentation">Documentation</a>
		<a class="nav-location-item" data-nav-location="doc-taskdoc" href="../../taskdoc/index.html" title="Build task documentation">TaskDoc</a>
		<a class="nav-location-item" data-nav-location="doc-javadoc" href="../../javadoc/index.html"title="Java API documentation">JavaDoc</a>
		<div class="nav-bar-controls">
			<label class="d-xl-none nav-bar-collapse" for="collapse-nav-bar-label">
				<svg style="height: 1.5em;" viewBox="0 0 24 24">
				    <path fill="currentColor" d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" />
				</svg>
			</label>
			<input style="display:none;" id="collapse-nav-bar-label" type="checkbox"/>
			<div class="nav-bar-items">
				<a href="/" title="saker.build home page">Home</a>
				<a href="/buildtrace.html" title="Build trace viewer">Build trace</a>
				<a style="display:none;" href="/sponsor.html" title="Sponsoring development">Sponsor</a>
				<a href="/blog/" title="saker.build system blog">Blog</a>
				<a class="no-external-icon" href="https://github.com/sakerbuild/saker.build" title="saker.build GitHub repository">GitHub</a>
			</div>
		</div>
	</div>
</div>
<div class="container page-contents packagedoc">
	<div class="row">
		<div class="col-12 col-lg-3 col-xl-2 p-lg-0">
			<div class="doc-navigation-container">
				<label class="d-lg-none nav-collapse" for="doc-collapse-nav-label">
					<svg style="height: 1.5em;" viewBox="0 0 24 24">
					    <path fill="currentColor" d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" />
					</svg>
					Navigation
				</label>
				<input style="display:none;" id="doc-collapse-nav-label" type="checkbox"/> 
				<div class="doc-nav">  <div class="doc-section"><ul><li><a class="doc-nav-section-link" href="../../index.html" title="Index">Index</a></li></ul>  </div>  <div class="doc-section">    <p class="section-title">Introduction</p><ul><li><a class="doc-nav-section-link" href="../index.html" title="Overview">Overview</a></li><li><label class="doc-nav-collapse" for="_doc_collapse_id_0"><a class="doc-nav-section-link" href="../installation.html" title="Installation">Installation</a></label><input style="display:none;" id="_doc_collapse_id_0" type="checkbox"/><label class="doc-nav-section-arrow" for="_doc_collapse_id_0"></label><ul><li><a class="doc-nav-section-link" href="../releasearchive.html" title="Release archive">Release archive</a></li></ul></li><li><a class="doc-nav-section-link" href="../roadmap.html" title="Roadmap">Roadmap</a></li></ul>  </div>  <div class="doc-section">    <p class="section-title">User guide</p><ul><li><a class="doc-nav-section-link" href="../userguide/index.html" title="Repository structure">Repository structure</a></li><li><a class="doc-nav-section-link" href="../userguide/buildtasks.html" title="Build tasks">Build tasks</a></li><li><a class="doc-nav-section-link" href="../userguide/versioning.html" title="Versioning">Versioning</a></li><li><label class="doc-nav-collapse" for="_doc_collapse_id_1"><a class="doc-nav-section-link" href="../userguide/configuration.html" title="Runtime configuration">Runtime configuration</a></label><input style="display:none;" id="_doc_collapse_id_1" type="checkbox"/><label class="doc-nav-section-arrow" for="_doc_collapse_id_1"></label><ul><li><a class="doc-nav-section-link" href="../userguide/serverstorage.html" title="Server storage">Server storage</a></li><li><a class="doc-nav-section-link" href="../userguide/localstorage.html" title="Local storage">Local storage</a></li><li><a class="doc-nav-section-link" href="../userguide/paramsstorage.html" title="Parameter storage">Parameter storage</a></li><li><a class="doc-nav-section-link" href="../userguide/constraints.html" title="Constraint properties">Constraint properties</a></li></ul></li><li><a class="doc-nav-section-link" href="../userguide/localbundles.html" title="Local bundles">Local bundles</a></li><li><label class="doc-nav-collapse" for="_doc_collapse_id_2"><a class="doc-nav-section-link" href="../userguide/cmdlineref/index.html" title="Command line reference">Command line reference</a></label><input style="display:none;" id="_doc_collapse_id_2" type="checkbox"/><label class="doc-nav-section-arrow" for="_doc_collapse_id_2"></label><ul><li><a class="doc-nav-section-link" href="../userguide/cmdlineref/main.html" title="main">main</a></li><li><label class="doc-nav-collapse" for="_doc_collapse_id_3"><a class="doc-nav-section-link" href="../userguide/cmdlineref/local.html" title="local">local</a></label><input style="display:none;" id="_doc_collapse_id_3" type="checkbox"/><label class="doc-nav-section-arrow" for="_doc_collapse_id_3"></label><ul><li><a class="doc-nav-section-link" href="../userguide/cmdlineref/local_install.html" title="install">install</a></li></ul></li><li><label class="doc-nav-collapse" for="_doc_collapse_id_4"><a class="doc-nav-section-link" href="../userguide/cmdlineref/server.html" title="server">server</a></label><input style="display:none;" id="_doc_collapse_id_4" type="checkbox"/><label class="doc-nav-section-arrow" for="_doc_collapse_id_4"></label><ul><li><a class="doc-nav-section-link" href="../userguide/cmdlineref/server_upload.html" title="upload">upload</a></li><li><label class="doc-nav-collapse" for="_doc_collapse_id_5"><a class="doc-nav-section-link" href="../userguide/cmdlineref/server_index.html" title="index">index</a></label><input style="display:none;" id="_doc_collapse_id_5" type="checkbox"/><label class="doc-nav-section-arrow" for="_doc_collapse_id_5"></label><ul><li><a class="doc-nav-section-link" href="../userguide/cmdlineref/server_index_update.html" title="update">update</a></li></ul></li></ul></li><li><a class="doc-nav-section-link" href="../userguide/cmdlineref/version.html" title="version">version</a></li></ul></li></ul>  </div>  <div class="doc-section">    <p class="section-title">Repository website</p><ul><li><a class="doc-nav-section-link" href="index.html" title="Overview">Overview</a></li><li><a class="doc-nav-section-link" href="naming.html" title="Naming">Naming</a></li><li><a class="doc-nav-section-link" href="uploading.html" title="Uploading bundles">Uploading bundles</a></li><li><a class="doc-nav-section-link" href="publishing.html" title="Publishing">Publishing</a></li><li><a class="doc-nav-section-link" href="descriptions.html" title="Descriptions">Descriptions</a></li><li><a class="doc-nav-section-link" href="faq.html" title="FAQ">FAQ</a></li><li class="doc-active doc-active-parent"><a class="doc-nav-section-link" href="repository_api.html" title="Repository web API">Repository web API</a></li></ul>  </div>  <div class="doc-section">    <p class="section-title">Development guide</p><ul><li><a class="doc-nav-section-link" href="../devguide/index.html" title="Overview">Overview</a></li><li><a class="doc-nav-section-link" href="../devguide/bundleformat.html" title="Bundle format">Bundle format</a></li><li><a class="doc-nav-section-link" href="../devguide/dependencies.html" title="Dependencies">Dependencies</a></li><li><a class="doc-nav-section-link" href="../devguide/classpath.html" title="Bundle classpath">Bundle classpath</a></li><li><a class="doc-nav-section-link" href="../devguide/dependencyhell.html" title="Dependency hell">Dependency hell</a></li><li><a class="doc-nav-section-link" href="../devguide/tasks.html" title="Build tasks">Build tasks</a></li><li><a class="doc-nav-section-link" href="../devguide/runtimeaccess.html" title="Accessing the repository runtime">Accessing the repository runtime</a></li><li><a class="doc-nav-section-link" href="../devguide/testing.html" title="Integration testing">Integration testing</a></li></ul>  </div></div>
			</div>
		</div>
		<div class="col-12 col-lg-9 col-xl-10 doc-page">
			<div class="sb-sponsors" style="display: none;">
	<span class="sb-sponsors-title">Sponsors</span>
	<div class="container">
		<div class="row">
			<div class="col-md-4 col-12">
				<a class="sb-sponsors-link"></a>
			</div>
			<div class="col-md-4 col-12">
				<a class="sb-sponsors-link"></a>
			</div>
			<div class="col-md-4 col-12">
				<a class="sb-sponsors-link"></a>
			</div>
		</div>
	</div>
</div>
			<div class="doc-content"><h1 id="repository-web-api">Repository web API<a class="doc-heading-anchor" href="#repository-web-api"></a></h1>
<div class="doc-wip">
<p>This section of the documentation is incomplete.</p>
</div>
<p>The saker.nest repository website at <a href="https://nest.saker.build" title="Saker.nest plugin repository">https://nest.saker.build</a> consists of two parts. A frontend that is displayed in the browser, and a backend that is the database and logic behind the site. This page describes the API that can be used to communicate with the backend server.</p>
<p>The API is available only via HTTPS and through the <code>https://api.nest.saker.build</code> address.</p>
<div class="doc-note">
<p>The site at <a href="https://nest.saker.build" title="Saker.nest plugin repository">https://nest.saker.build</a> uses other API endpoints that are not part of this document. They are subject to change at any time. You should only rely on API functions that are described in this document.</p>
</div>
<h2 id="requests-types">Requests types<a class="doc-heading-anchor" href="#requests-types"></a></h2>
<p>The API server distinguises two kinds of requests.</p>
<h3 id="unauthenticated-requests">Unauthenticated requests<a class="doc-heading-anchor" href="#unauthenticated-requests"></a></h3>
<p>These kinds of requests require no authentication by the client.</p>
<h3 id="authenticated-requests">Authenticated requests<a class="doc-heading-anchor" href="#authenticated-requests"></a></h3>
<p>These requests need to be signed by the client using the API keys previously provided by the server. Authenticated requests need to be formatted in a way that can be interpreted by the server.</p>
<p>The API keys are a pair of byte sequences that are used to authenticate the client. It consists of an API key and API secret. You shouldn't share these keys with anyone. Most commonly, you'll be using the API keys for uploading bundles for your packages.</p>
<p>Example:</p>
<pre><code>Key: YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY
Secret: NjU0MzIxenl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmE
</code></pre>
<p>As an example, the above keys can be retrieved from the Bundles tab at <a href="https://nest.saker.build/user/packages" title="Manage packages | saker.nest">https://nest.saker.build/user/packages</a>. The above keys are invalid, and serve only as an example.</p>
<h4 id="request-format">Request format<a class="doc-heading-anchor" href="#request-format"></a></h4>
<p>An authenticated request consists of the following:</p>
<ul>
<li>The API key. (<strong>Not</strong> the <em>Secret</em>.)</li>
<li>The request contents.</li>
<li>The request signature.</li>
</ul>
<p>In order to construct a request, you need to sign the contents of the request. The signed contents consist of the UTF-8 encoded bytes of the following (in this order):</p>
<ul>
<li>Request HTTP method (POST, GET, ...)</li>
<li>Full request URL</li>
<li>The API Key (URL-safe Base64 (RFC 4648 Section 5) encoded string <em>without padding</em>)</li>
<li>The request contents</li>
</ul>
<p>The signing algorithm is: <code>HmacSHA256</code>. The API Secret is the key for the signing.</p>
<p>The actual API key and signature is passed in the request as the following headers:</p>
<ul>
<li><code>NestAPIKey</code>: The URL-safe Base64 (RFC 4648 Section 5) encoded string of the API Key. (<strong>Not</strong> the secret, only the key.)</li>
<li><code>NestRequestMAC</code>: The URL-safe Base64 encoded string of the signature produced as above.</li>
</ul>
<p>See also: <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Base64.html#getUrlEncoder--" title="Base64 (Java Platform SE 8 )"><code>Base64.getUrlEncoder()</code></a>.</p>
<p>The following Java snippet can be used to initialize a request:</p>
<pre><code class="language-java">// (exception handling omitted)
byte[] apikey; // decoded to raw bytes
byte[] apisecret; // decoded to raw bytes
// URL-safe Base64 encoder without padding
Encoder base64encoder = Base64.getUrlEncoder().withoutPadding();

// example request contents 
String httpmethod = &quot;POST&quot;;
String url = &quot;https://api.nest.saker.build/...&quot;;
String apikeybase64 = base64encoder.encodeToString(apikey);
String requestcontents = &quot;{ contents: \&quot;of-the-request\&quot; }&quot;;

Mac sha256_HMAC = Mac.getInstance(&quot;HmacSHA256&quot;);
sha256_HMAC.init(new SecretKeySpec(apisecret, &quot;HmacSHA256&quot;));
sha256_HMAC.update(httpmethod.getBytes(StandardCharsets.UTF_8));
sha256_HMAC.update(url.getBytes(StandardCharsets.UTF_8));
sha256_HMAC.update(apikeybase64.getBytes(StandardCharsets.UTF_8));
sha256_HMAC.update(requestcontents.getBytes(StandardCharsets.UTF_8));
byte[] macbytes = sha256_HMAC.doFinal();

HttpURLConnection urlconn = (HttpURLConnection) new URL(url).openConnection();
urlconn.setRequestMethod(httpmethod);
urlconn.setRequestProperty(&quot;NestAPIKey&quot;, apikeybase64);
urlconn.setRequestProperty(&quot;NestRequestMAC&quot;, base64encoder.encodeToString(macbytes));
urlconn.setDoOutput(true);
try (OutputStream os = urlconn.getOutputStream()) {
	os.write(requestcontents.getBytes(StandardCharsets.UTF_8));
}
</code></pre>
<h2 id="bundle-downloading">Bundle downloading<a class="doc-heading-anchor" href="#bundle-downloading"></a></h2>
<p><em>Unauthenticated.</em></p>
<pre><code>GET https://api.nest.saker.build/bundle/download/&lt;bundle-id&gt;
</code></pre>
<p>Allowed methods: <code>GET</code>, <code>POST</code>, <code>HEAD</code></p>
<p>The <code>bundle-id</code> parameter contains the full bundle identifier for the downloaded bundle including the version qualifier.</p>
<p><strong>Contents</strong></p>
<p>The request contains no contents.</p>
<p><strong>Response</strong></p>
<p>The binary byte stream of the bundle contents or an error describing the issue.</p>
<p>The server may also respond with status code 302 in which case the download should be attempted from that address.</p>
<h2 id="bundle-upload-allocation">Bundle upload allocation<a class="doc-heading-anchor" href="#bundle-upload-allocation"></a></h2>
<p><strong>Authenticated.</strong></p>
<p>Asks the server to allocate the resources for an upcoming bundle upload.</p>
<pre><code>POST https://api.nest.saker.build/bundle/upload/allocate?bundleid=&lt;bundle-id&gt;&amp;overwrite=&lt;bool&gt;
</code></pre>
<p>Allowed methods: <code>POST</code></p>
<p>The <code>bundle-id</code> parameter contains the full bundle identifier for the uploaded bundle including the version qualifier.</p>
<p>The <code>overwrite</code> optional parameter specifies whether or not the already uploaded bundle can be overwritten.</p>
<p><strong>Contents</strong></p>
<p>The request contains no contents.</p>
<p><strong>Response</strong></p>
<p>HTTP 200 with JSON response that contains the URL to where the bundle uploading can proceed.</p>
<p>Example:</p>
<pre><code class="language-json">{
	&quot;error&quot;: &quot;success&quot;,
	&quot;uploadurl&quot;: &quot;https://api.nest.saker.build/url/where/you/can/upload/the/bundle&quot;
}
</code></pre>
<p>The server can respond with errors in cases as follows:</p>
<ul>
<li>You don't have the permission to upload a bundle for that package.</li>
<li>The version to which the upload would be performed was already published.</li>
<li>For other reasons.</li>
</ul>
<p>The server may also respond with HTTP 503, in which case you should try the request again after the timeout specified in the <code>Retry-Again</code> header. In this case the response contains the <code>&quot;try-again&quot;</code> error code and the <code>&quot;seconds&quot;</code> field also contains the timeout length.</p>
<p>See the <a href="repository_api.html#bundle-uploading" title="Bundle uploading">next chapter</a> for performing the bundle upload.</p>
<h2 id="bundle-uploading">Bundle uploading<a class="doc-heading-anchor" href="#bundle-uploading"></a></h2>
<p><em>Unauthenticated.</em></p>
<p>Uploads the bundle to the URl retrieved from <a href="repository_api.html#bundle-upload-allocation" title="Bundle upload allocation">Bundle upload allocation</a>.</p>
<pre><code>POST https://api.nest.saker.build/url/that/you/received/after/allocation
</code></pre>
<p>Allowed methods: <code>POST</code></p>
<p><strong>Contents</strong></p>
<p>The contents should be a single bundle in <a href="https://tools.ietf.org/html/rfc2388" title="RFC 2388 - Returning Values from Forms: multipart/form-data"><code>multipart/form-data</code></a> format.</p>
<p><strong>Response</strong></p>
<p>HTTP 200 if the bundle uploading was successful. The server will proceed to validate the bundle contents and the status will be displayed on the Bundles tab of the <a href="https://nest.saker.build/user/packages" title="Manage packages | saker.nest">bundle management page</a>.</p>
<h2 id="bundle-index">Bundle index<a class="doc-heading-anchor" href="#bundle-index"></a></h2>
<div class="doc-wip">
<p>This section of the documentation is incomplete.</p>
</div>
<h2 id="task-index">Task index<a class="doc-heading-anchor" href="#task-index"></a></h2>
<div class="doc-wip">
<p>This section of the documentation is incomplete.</p>
</div>
<link href="../../../css/sakerscript.css"  rel="stylesheet" type="text/css" /></div>
			<div class="end-section-links">
				<div class="end-section-prev">
					<a class="doc-prev-section" href="../../doc/websiteguide/faq.html" title="FAQ"><svg class="doc-section-arrow" viewBox="0 0 24 24">
    <path fill="currentColor" d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" />
</svg>FAQ</a>
				</div>
				<div class="end-section-next">
					<a class="doc-next-section" href="../../doc/devguide/index.html" title="Overview">Overview<svg class="doc-section-arrow" viewBox="0 0 24 24">
    <path fill="currentColor" d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" />
</svg></a>
				</div>
			</div>
			<div class="doc-headings-nav">  <ul>    <li><a href="#repository-web-api" title="Repository web API">Repository web API</a>      <ul>        <li><a href="#requests-types" title="Requests types">Requests types</a>          <ul>            <li><a href="#unauthenticated-requests" title="Unauthenticated requests">Unauthenticated requests</a>            </li>            <li><a href="#authenticated-requests" title="Authenticated requests">Authenticated requests</a>              <ul>                <li><a href="#request-format" title="Request format">Request format</a>                </li>              </ul>            </li>          </ul>        </li>        <li><a href="#bundle-downloading" title="Bundle downloading">Bundle downloading</a>        </li>        <li><a href="#bundle-upload-allocation" title="Bundle upload allocation">Bundle upload allocation</a>        </li>        <li><a href="#bundle-uploading" title="Bundle uploading">Bundle uploading</a>        </li>        <li><a href="#bundle-index" title="Bundle index">Bundle index</a>        </li>        <li><a href="#task-index" title="Task index">Task index</a>        </li>      </ul>    </li>  </ul></div>
		</div>
	</div>
</div>
<div class="doc-footer">
	<div class="container">
		<div class="row">
			<div class="footer-section col-6 col-sm-4 col-md-3">
				<p class="footer-section-title">About</p>
				<div><a href="/index.html" title="Saker.build home page">Home</a></div>
				<div data-footer-location="doc-docs"><a href="../../index.html" title="saker.nest documentation index">Documentation index</a></div>
				<div><a href="../../../saker.build/index.html" title="Information about the saker.build system">saker.build system</a></div>
				<div><a href="../../../saker.nest/index.html" title="Information about the saker.nest repository">saker.nest repository</a></div>
				<div><a href="/contact.html" title="Contact us">Contact</a></div>
			</div>
			<div class="footer-section col-6 col-sm-4 col-md-3">
				<p class="footer-section-title">Resources</p>
				<div data-footer-location="doc-docs"><a href="../../doc/index.html" title="saker.nest documentation index">Documentation</a></div>
				<div data-footer-location="doc-javadoc"><a href="../../javadoc/index.html" title="JavaDoc for saker.nest">JavaDoc</a></div>
				<div data-footer-location="doc-taskdoc"><a href="../../taskdoc/index.html"  title="Documentation of build tasks in saker.nest">TaskDoc</a></div>
				<div data-footer-location="nest-package"><a href="https://nest.saker.build/package/saker.nest" title="saker.nest | saker.nest">saker.nest package page</a></div>
				<div><a href="https://github.com/sakerbuild/saker.nest" title="saker.nest on GitHub">GitHub</a></div>
			</div>
		</div>	
		<div class="row">
			<div class="col">
			&copy; Bence Sipka 2020
			</div>
		</div>
	</div>
</div>

<link rel="stylesheet" href="../../../res/hljs.css"><script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.8/build/highlight.min.js" integrity="sha256-js+I1fdbke/DJrW2qXQlrw7VUEqmdeFeOW37UC0bEiU=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.13.1/build/languages/java.min.js"></script><script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.13.1/build/languages/json.min.js"></script>
<script>
if(window.hasOwnProperty("hljs")){
	hljs.configure({
	  languages: []
	});
	hljs.initHighlightingOnLoad();
}
</script>

</body>
</html>